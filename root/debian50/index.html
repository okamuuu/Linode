<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf8" />
    <title>接続元ネットワークを制限する | How to Linode</title>
    <meta name="keywords" content="SSH, SSH接続, DEV-01" />
    <meta name="description" content="boot直後はサーバーは無防備の状態であり、不特定多数のネットワークからログインを試みる事ができます。まずはアクセスを許可するネットワークを制限します。" />
    <meta name="robots" content="all" />

    <link rel="stylesheet" type="text/css" media="screen" href="../common/css/import.css"/>
</head>
<body>
	<div id="wrapper">
		<div id="wrap">
			<div id="header">
				<p id="title"><a href="/">How to Linode</a></p>
			</div>
<!-- category[start] -->
<ul id="tab">
<li><a href="/" class="home">HOME</a></li>
<li><a href="/centos53/" class="centos53">CentOS5.3</a></li>
<li><a href="/debian50/" class="debian50 current">Debian5.0</a></li>
</ul>
<!-- category[end] -->

<!-- bread[start] -->
<p id="bread">
<a href="/">home</a> &gt;
接続元ネットワークを制限する
</p>
<!-- bread[end] -->

			<div id="side-bar">
<!-- menu[start] -->
<h3>初期設定</h3>
<ul class="menu">
    <li><a href="index.html">接続元ネットワークを制限する</a></li>
    <li><a href="02-ssh.html">SSHのログオンユーザーを制限</a></li>
    <li><a href="02-sudo.html">sudo導入</a></li>
    <li><a href="02-vim.html">vi拡張</a></li>
    <li><a href="02-screen.html">screen導入</a></li>
    <li><a href="02-zsh.html">zsh導入</a></li>
    <li><a href="02-ntpd.html">日付設定</a></li>
    <li><a href="02-service_all.html">サービス確認</a></li>
</ul>
<!-- menu[end] -->

			</div>
		    <div id="content">
		        <h1 id="接続元ネットワークを制限する">接続元ネットワークを制限する</h1>
<p id="description">boot直後はサーバーは無防備の状態であり、不特定多数のネットワークから<br />ログインを試みる事ができます。<br />まずはアクセスを許可するネットワークを制限します。</p>
<h2 id="作業概要">作業概要</h2>
<ul><li>自身が利用しているネットワークを確認する。
</li><li>自身が利用しているネットワーク以外からの<em>SSH</em>を禁止する。</li></ul>
<h2 id="自身が利用しているネットワークを確認する">自身が利用しているネットワークを確認する</h2>
<p>
現時点ではSSHポートに対して誰でもアクセスできる状態です。
自分が使用しているISP以外からはアクセスできないように規制します。
</p>
<p>
過去のログインユーザー一覧情報を表示して
自身が利用しているISPを確認します。
</p>
<pre class="wiki">
# last -a
root     pts/0        Sun Feb 14 04:07   still logged in    xx123-45-658-151.xxx.example.ne.jp
</pre>
<p>
ここでは xx123-45-658-151.xxx.example.ne.jpと表示されていたと仮定します。
</p>
<h2 id="自身が利用しているネットワーク以外からのSSHを禁止する">自身が利用しているネットワーク以外からのSSHを禁止する</h2>
<pre class="wiki">
# vim /etc/hosts.deny
</pre>
<p>
次の行を追記します。
</p>
<pre class="wiki">
All: All
</pre>
<p>
/etc/hosts.allowを編集します
</p>
<pre class="wiki">
# vim /etc/hosts.allow
</pre>
<pre class="wiki">
SSHD: All .example.ne.jp
</pre>
<p>
ひとまずあなたが契約しているISP経由でないと<em>SSH接続</em>ができないようになりました。
</p>
<h2 id="セキュリティのアップデート">セキュリティのアップデート</h2>
<p>
上記の作業が完了したら次のコマンドを実行します。
</p>
<pre class="wiki">
apt-get update
apt-get upgrade --show-upgraded
</pre>
<h3 id="結果">結果</h3>
<pre class="wiki">
# apt-get update
# apt-get upgrade --show-upgraded
</pre>
<h2 id="HOSTNAMEの設定">HOSTNAMEの設定</h2>
<p>
HOSTNAMEは通常自分の好きな名前をつけるものなので各自で自由に設定してみてください。
ここでは<em>DEV-01</em>と名付けました。
</p>
<pre class="wiki">
# echo &quot;DEV-01&quot; &gt; /etc/HOSTNAME
# hostname -F /etc/HOSTNAME
</pre>
<p>
DEV-01というhostnameはローカルルールなのでどのIPアドレスの事を指しているかを
/etc/hostsで指定しておく。
</p>
<pre class="wiki">
# vim /etc/hosts
</pre>
<pre class="wiki">
74.207.2XX.XXX DEV-01
</pre>
<h2 id="一般ユーザー作成">一般ユーザー作成</h2>
<p>
一般ユーザーを作成します。ここでは例としてhomepageと
名付けていますが各自で好きな名前を使用して下さい。
</p>
<pre class="wiki">
# addgroup --gid 1000 agent
# useradd homepage -g agent --uid 1001 -m 
# passwd homepage
Changing password for user homepage.
New UNIX password:
Retype new UNIX password:
passwd: all authentication tokens updated successfully.
</pre>
<h2 id="localeの設定">localeの設定</h2>
<pre class="wiki">
% sudo su
# cat &lt;&lt;END_LOCALE &gt; /etc/locale.gen
en_US ISO-8859-1
en_US.UTF-8 UTF-8
ja_JP.UTF-8 UTF-8
ja_JP.EUC-JP EUC-JP
END_LOCALE
# locale-gen
# exit
</pre>

		    </div>
			<br class="clear" />
			<div id="footer">
				<p>
					<a href="http://linode.jp">Linode</a> | 
					<a href="http://www.add9.biz/phpunit">PHPUnit</a> | 
					<a href="http://www.add9.biz/symfony">Symfony</a>
					<br />
				
					<a href="http://www.add9.biz/c">C</a> | 
					<a href="http://www.add9.biz/moose">Moose</a> | 
					<a href="http://www.add9.biz/design_pattern">Design Pattern</a>
					<br />

					<a href="http://www.add9.biz/jump">Jump Attack Forum</a> | 
					<a href="http://dancepod.tv">DancePod.tv</a>
				</p>
			</div>
	    </div>
		<div id="adsence">
			<script type="text/javascript"><!--
			google_ad_client = "pub-3627018862025650";
			google_ad_slot = "0294735282";
			google_ad_width = 160;
			google_ad_height = 600;
			//-->
			</script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
		</div>
	</div>
	<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
	try {
	var pageTracker = _gat._getTracker("UA-7965172-1");
	pageTracker._trackPageview();
	} catch(err) {}</script>
</body>
</html>
