<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf8" />
    <title>日付設定 | How to Linode</title>
    <meta name="keywords" content="" />
    <meta name="description" content="日付の設定を日本時間に直します。" />
    <meta name="robots" content="all" />

    <link rel="stylesheet" type="text/css" media="screen" href="../common/css/import.css"/>
</head>
<body>
	<div id="wrapper">
		<div id="wrap">
			<div id="header">
				<p id="title"><a href="/">How to Linode</a></p>
			</div>
<!-- category[start] -->
<ul id="tab">
<li><a href="/" class="home">HOME</a></li>
<li><a href="/centos53/" class="centos53">CentOS5.3</a></li>
<li><a href="/debian50/" class="debian50 current">Debian5.0</a></li>
</ul>
<!-- category[end] -->

<!-- bread[start] -->
<p id="bread">
<a href="/">home</a> &gt;
日付設定
</p>
<!-- bread[end] -->

			<div id="side-bar">
<!-- menu[start] -->
<h3>初期設定</h3>
<ul class="menu">
    <li><a href="index.html">接続元ネットワークを制限する</a></li>
    <li><a href="02-ssh.html">SSHのログオンユーザーを制限</a></li>
    <li><a href="02-sudo.html">sudo導入</a></li>
    <li><a href="02-vim.html">vi拡張</a></li>
    <li><a href="02-screen.html">screen導入</a></li>
    <li><a href="02-zsh.html">zsh導入</a></li>
    <li><a href="02-ntpd.html">日付設定</a></li>
    <li><a href="02-service_all.html">サービス確認</a></li>
</ul>
<!-- menu[end] -->

			</div>
		    <div id="content">
		        <h1 id="日付設定">日付設定</h1>
<p id="description">日付の設定を日本時間に直します。</p>
<h2 id="日付を日本時間に合わせる">日付を日本時間に合わせる</h2>
<p>
timezoneを確認する
</p>
<pre class="wiki">
% cat /etc/timezone
Etc/UTC
</pre>
<p>
UTCになっているのでこれをJSTにしつつ、日本時間に合わせる
</p>
<pre class="wiki">
% sudo echo 'Asia/Tokyo' | sudo tee /etc/timezone
</pre>
<p>
この状態で以下のコマンドを実行するとAsia/Tokyoを選ぶとJSTになる
</p>
<pre class="wiki">
% sudo dpkg-reconfigure tzdata
</pre>
<p>
※この場合スクリプトで自動設定が難しいので後日再挑戦
</p>
<p>
<tt>
</p>
<h2 id="ntpサーバーと同期">ntpサーバーと同期</h2>
<h3 id="インストール">インストール</h3>
<pre class="wiki">
% sudo yum -y install ntp
Do you want to continue? [Y/n/?] Y
</pre>
<h3 id="設定">設定</h3>
<p>
設定ファイルを編集します。
</p>
<pre class="wiki">
% sudo vi /etc/ntp.conf
</pre>
<p>
内部からの時刻同期を許可し、日本標準時を提供しているNTPサーバーとそのサーバーに直接同期しているNTPサーバーを追加します。
</p>
<pre class="wiki">
# Hosts on local network are less restricted.
restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap　←　←コメントをはずす(内部からの時刻同期を許可)

server ntp.nict.jp
server ntp.nict.jp
server ntp.nict.jp
#server 0.debian.pool.ntp.org iburst dynamic
#server 1.debian.pool.ntp.org iburst dynamic
#server 2.debian.pool.ntp.org iburst dynamic
#server 3.debian.pool.ntp.org iburst dynamic

</pre>
<p>
NTPサーバー起動時に大幅に時刻がずれているとNTPサーバーが起動できないので、いったん、手動で時刻を合わせる
</p>
<pre class="wiki">
% sudo aptitude update
% sudo aptitude install ntpdate
% sudo /usr/sbin/ntpdate ntp.nict.jp
</pre>
<p>
再起動
</p>
<pre class="wiki">
% sudo /etc/init.d/ntp restart
</pre>
<p>
PC再起動時にntpdを自動起動に設定する。
</p>
<pre class="wiki">
% sudo /sbin/chkconfig ntpd on
% sudo /sbin/chkconfig --list ntpd
ntpd            0:off   1:off   2:on    3:on    4:on    5:on    6:off　←　ランレベル2～5のonを確認
</pre>
<h2 id="確認">確認</h2>
<p>
NTPサーバーへの時刻同期状態確認
</p>
<pre class="wiki">
% sudo ntpq -p
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
 ntp-a3.nict.go. .NICT.           1 u   24   64    7  113.539    3.891   7.669

※NTPサーバー名の前が空白の場合は時刻同期中の状態
</pre>
<p>
約10分後、再度NTPサーバーへの時刻同期状態確認
</p>
<pre class="wiki">
% ntpq -p
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
*ntp-a2.nict.go. .PPS.            1 u    6   64   37    8.281    1.605   0.320
+ntp2.jst.mfeed. 210.173.160.86   2 u    4   64   37    7.545    2.592   0.910
+orion.asahi-net 202.224.53.11    2 u    1   64   37    6.579   -3.557   0.833
※NTPサーバー名の前に*または+が表示されれば時刻同期完了の状態(ntpqの説明)

</pre>

		    </div>
			<br class="clear" />
			<div id="footer">
				<p>
					<a href="http://linode.jp">Linode</a> | 
					<a href="http://www.add9.biz/phpunit">PHPUnit</a> | 
					<a href="http://www.add9.biz/symfony">Symfony</a>
					<br />
				
					<a href="http://www.add9.biz/c">C</a> | 
					<a href="http://www.add9.biz/moose">Moose</a> | 
					<a href="http://www.add9.biz/design_pattern">Design Pattern</a>
					<br />

					<a href="http://www.add9.biz/jump">Jump Attack Forum</a> | 
					<a href="http://dancepod.tv">DancePod.tv</a>
				</p>
			</div>
	    </div>
		<div id="adsence">
			<script type="text/javascript"><!--
			google_ad_client = "pub-3627018862025650";
			google_ad_slot = "0294735282";
			google_ad_width = 160;
			google_ad_height = 600;
			//-->
			</script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
		</div>
	</div>
	<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
	try {
	var pageTracker = _gat._getTracker("UA-7965172-1");
	pageTracker._trackPageview();
	} catch(err) {}</script>
</body>
</html>
