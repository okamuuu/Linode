<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf8" />
    <title>バーチャルホスト設定 | How to Linode</title>
    <meta name="keywords" content="virtualHost" />
    <meta name="description" content="http,httpsによるサービスが利用できる状態にします。原則Documentルートは使用しません。すべてVirtualHostによる設定を行います。" />
    <meta name="robots" content="all" />

    <link rel="stylesheet" type="text/css" media="screen" href="../common/css/import.css"/>
</head>
<body>
	<div id="wrapper">
		<div id="wrap">
			<div id="header">
				<p id="title"><a href="/">How to Linode</a></p>
			</div>
<!-- category[start] -->
<ul id="tab">
<li><a href="/" class="home">HOME</a></li>
<li><a href="/centos53/" class="centos53 current">CentOS5.3</a></li>
<li><a href="/debian50/" class="debian50">Debian5.0</a></li>
</ul>
<!-- category[end] -->

<!-- bread[start] -->
<p id="bread">
<a href="/">home</a> &gt;
バーチャルホスト設定
</p>
<!-- bread[end] -->

			<div id="side-bar">
<!-- menu[start] -->
<h3>初期設定</h3>
<ul class="menu">
    <li><a href="index.html">OS起動</a></li>
    <li><a href="02-ssh.html">OpenSSH設定</a></li>
    <li><a href="02-yum.html">yum最適化</a></li>
    <li><a href="02-sudo.html">sudo導入</a></li>
    <li><a href="02-vim.html">vi拡張</a></li>
    <li><a href="02-screen.html">screen導入</a></li>
    <li><a href="02-zsh.html">zsh導入</a></li>
    <li><a href="02-ntpd.html">日付設定</a></li>
</ul>
<!-- menu[end] -->

<!-- menu[start] -->
<h3>Webサーバー構築</h3>
<ul class="menu">
    <li><a href="03-virtualhost.html">バーチャルホスト設定</a></li>
    <li><a href="03-htdigest.html">認証ページ作成</a></li>
    <li><a href="03-ssl.html">SSL通信</a></li>
    <li><a href="03-fcgi.html">FCGI</a></li>
    <li><a href="03-memcache.html">mamcache</a></li>
</ul>
<!-- menu[end] -->

<!-- menu[start] -->
<h3>メールサーバー構築</h3>
<ul class="menu">
    <li><a href="04-postfix.html">Postifx</a></li>
    <li><a href="04-dovecot.html">dovecot</a></li>
    <li><a href="04-mailx.html">mailコマンド導入</a></li>
</ul>
<!-- menu[end] -->

<!-- menu[start] -->
<h3>セキュリティ強化</h3>
<ul class="menu">
    <li><a href="05-tripwire.html">Tripwire</a></li>
    <li><a href="05-chkrootkit.html">chkrootkit</a></li>
    <li><a href="05-snort.html">Snort + Oinkmaster</a></li>
    <li><a href="05-swatch.html">SWATCH</a></li>
    <li><a href="05-clam.html">Clam AntiVirus</a></li>
</ul>
<!-- menu[end] -->

<!-- menu[start] -->
<h3>DBサーバー構築</h3>
<ul class="menu">
    <li><a href="06-mysql.html">MySQL導入</a></li>
    <li><a href="06-mysql_backup.html">MySQLバックアップ</a></li>
</ul>
<!-- menu[end] -->

<!-- menu[start] -->
<h3>開発者向けツール導入</h3>
<ul class="menu">
    <li><a href="07-subversion.html">subversion</a></li>
    <li><a href="07-trac.html">Trac</a></li>
    <li><a href="07-hotcopy_svn_trac.html">Trac & SVN バックアップ</a></li>
    <li><a href="07-git.html">git</a></li>
</ul>
<!-- menu[end] -->

<!-- menu[start] -->
<h3>バックアップ強化</h3>
<ul class="menu">
    <li><a href="08-backup.html">自動バックアップ</a></li>
    <li><a href="08-subversion.html">MySQL導入</a></li>
    <li><a href="08-cwRsync.html">rsyncクライアント導入</a></li>
    <li><a href="08-mysql_backup.html">MySQLバックアップ</a></li>
</ul>
<!-- menu[end] -->

			</div>
		    <div id="content">
		        <h1 id="バーチャルホスト設定">バーチャルホスト設定</h1>
<p id="description">http,httpsによるサービスが利用できる状態にします。<br />原則Documentルートは使用しません。<br />すべてVirtualHostによる設定を行います。</p>
<h2 id="httpd確認">httpd確認</h2>
<p>
httpdが導入されているかどうかを確認します。
</p>
<pre class="wiki">
$ sudo yum list | grep httpd
httpd.i386                               2.2.3-22.el5.centos.2         updates
httpd-devel.i386                         2.2.3-22.el5.centos.2         updates
httpd-manual.i386                        2.2.3-22.el5.centos.2         updates
</pre>
<p>
インストール
</p>
<pre class="wiki">
$ sudo yum -y install httpd httpd-devel httpd-manual
</pre>
<p>
httpd-develにはapxsなどがはいっています。
</p>
<h2 id="設定">設定</h2>
<p>
以下の修正を行います。
</p>
<ul><li>エラーページなどでOS名を表示しない。
</li><li>エラーページなどで表示される管理者メールアドレスを変更する。
</li><li>ServerNameを変更する
</li><li>エラーページなどでApacheのバージョンを表示しないようにする
</li><li>iconsディレクトリのファイル一覧を表示しないようにする</li></ul>
<p>
設定ファイルを修正します。
</p>
<pre class="wiki">
$ sudo vi /etc/httpd/conf/httpd.conf
</pre>
<pre class="wiki">
ServerTokens Prod
ServerAdmin admin@your-domain.com
ServerName example.jp:80
ServerSignature Off

&lt;Directory &quot;/var/www/icons&quot;&gt;
    Options MultiViews	← iconsディレクトリのファイル一覧を表示しないようにする
    AllowOverride None
    Order allow,deny
    Allow from all
&lt;/Directory&gt;
</pre>
<p>
テストページ削除
</p>
<pre class="wiki">
$sudo rm -f /etc/httpd/conf.d/welcome.conf
$sudo rm -f /var/www/error/noidex.html
</pre>
<p>
WEBサーバー起動および自動起動設定
</p>
<pre class="wiki">
$ sudo /sbin/service httpd start
$ sudo /sbin/chkconfig httpd on
</pre>
<p>
ランレベル2,3,4,5がonになっている事を確認します。
</p>
<pre class="wiki">
$ sudo /sbin/chkconfig --list httpd
httpd           0:off   1:off   2:on    3:on    4:on    5:on    6:off
</pre>
<h2 id="virtualHost">virtualHost</h2>
<p>
<em>virtualHost</em>の設定を行います。
</p>
<p>
最初にテストページを作成します。
</p>
<pre class="wiki">
$ mkdir -p ~/Prj/BLANK/root/logs ~/Prj/TEST/root/logs
$ echo blank &gt;&gt; ~/Prj/BLANK/root/index.html
$ echo test  &gt;&gt; ~/Prj/TEST/root/index.html
$ chmod 0755 ~/Prj/BLANK/root/index.html
$ chmod 0755 ~/Prj/TEST/root/index.html
</pre>
<p>
一般ユーザーのディレクトリ以下を他ユーザー(apache)が実行可能にする。
<tt>
$ chmod 0701 ~
</tt>
</p>
<p>
virtualHost設定を/etc/httpd/conf/httpd.confに記述します。
</p>
<pre class="wiki">
$ sudo vi /etc/httpd/conf/httpd.conf
</pre>
<pre class="wiki">
#DocumentRoot &quot;/var/www/html&quot;	←IP直接入力の場合はVirtualHostの先頭の設定が呼ばれることになる
NameVirtualHost *:80	←VirtualHostを有効化
</pre>
<p>
ファイルの最終行に以下を追加
</p>
<pre class="wiki">
&lt;VirtualHost *:80&gt;
    ServerName blank.example.com
    DocumentRoot /home/homepage/Prj/BLANK/root
    CustomLog &quot;| /usr/sbin/rotatelogs /home/homepage/Prj/BLANK/logs/blank_access_log.%Y%m%d 86400 540&quot; combined env=!static_files
    ErrorLog  &quot;| /usr/sbin/rotatelogs /home/homepage/Prj/BLANK/logs/blank_error_log.%Y%m%d 86400 540&quot;
&lt;/VirtualHost&gt;

&lt;VirtualHost *:80&gt;
    ServerName test.example.com
    DocumentRoot /home/homepage/Prj/TEST/root
    CustomLog &quot;| /usr/sbin/rotatelogs /home/homepage/Prj/TEST/logs/test_access_log.%Y%m%d 86400 540&quot; combined env=!static_files
    ErrorLog  &quot;| /usr/sbin/rotatelogs /home/homepage/Prj/TEST/logs/test_error_log.%Y%m%d 86400 540&quot;
&lt;/VirtualHost&gt;

</pre>
<p>
再起動
</p>
<pre class="wiki">
% sudo /sbin/service httpd restart
</pre>
<h2 id="名前解決">名前解決</h2>
<p>
まだDNSの設定をしていない場合は次の作業を行います。
</p>
<h3 id="windowsの場合">windowsの場合</h3>
<p>
C:\WINDOWS\system32\drivers\etc\hostsをテキストエディタで開き、次の様な記述を追記します。XXXの場所はあなたが契約しているLinodeのIPアドレスを当てはめてください。
</p>
<pre class="wiki">
74.207.XXX.XXX blank.example.com
74.207.XXX.XXX test.example.com
74.207.XXX.XXX test2.example.com
</pre>
<h2 id="確認">確認</h2>
<p>
ブラウザで次の作業を行います。
</p>
<p>
* IPアドレスが直接入力された場合はblankと表示される
* blank.example.comとしてリクエストされた場合はblankと表示される
* test.example.comとしてリクエストされた場合はtestと表示される
* test2.example.comとしてリクエストされた場合はblankと表示される
</p>

		    </div>
			<br class="clear" />
			<div id="footer">
				<p>
					<a href="http://linode.jp">Linode</a> | 
					<a href="http://www.add9.biz/phpunit">PHPUnit</a> | 
					<a href="http://www.add9.biz/symfony">Symfony</a>
					<br />
				
					<a href="http://www.add9.biz/c">C</a> | 
					<a href="http://www.add9.biz/moose">Moose</a> | 
					<a href="http://www.add9.biz/design_pattern">Design Pattern</a>
					<br />

					<a href="http://www.add9.biz/jump">Jump Attack Forum</a> | 
					<a href="http://dancepod.tv">DancePod.tv</a>
				</p>
			</div>
	    </div>
		<div id="adsence">
			<script type="text/javascript"><!--
			google_ad_client = "pub-3627018862025650";
			google_ad_slot = "0294735282";
			google_ad_width = 160;
			google_ad_height = 600;
			//-->
			</script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
		</div>
	</div>
	<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
	try {
	var pageTracker = _gat._getTracker("UA-7965172-1");
	pageTracker._trackPageview();
	} catch(err) {}</script>
</body>
</html>
